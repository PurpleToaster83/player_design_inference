<!Doctype html>
<html ng-app="experimentApp">

<head>
  <title>Player Pragmatic Design Inferance</title>
  <link rel="icon" type="image/x-icon" href="images/icon.png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="styling.css"

  <!-- AngularJS -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.0/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.0/angular-sanitize.js"></script>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <!-- Initialize Firebase -->
  <script src="https://player-app-fbf4c.firebaseapp.com/__/firebase/init.js"></script>
  <!-- Experiment App -->
  <script src="lib/preloader.js"></script>
  <script src="app.js"></script>
</head>

<body ng-controller="ExperimentController" ng-init="set_stimuli()">
  <div class="main w3-row">

    <!-- Left Side -->
    <div class="w3-col m5">

      <!-- Instructions -->
      <div ng-show="section == 'instructions' && instruction_has_text() && !instruction_has_image()" class="full-row"
        ng-bind-html="instructions[inst_id].text" ng-cloak>
      </div>

      <!-- Exam Questions-->
      <ul class="no-bullets-full-row" ng-show="is_exam()" ng-repeat="opt in instructions[inst_id].options" ng-cloak>
        <li><input type="radio" name="exam" ng-model="exam_response" ng-click="validate_exam(opt)" ng-disabled="is_feedback()" value="{{opt}}">
          <span class="checkboxtext" ng-bind-html="opt"></span>
        </li>
      </ul>
      <ul class="no-bullets-full-row" ng-show="is_feedback()" ng-repeat="opt in instructions[inst_id].options" ng-cloak>
        <li><input type="radio" name="exam" ng-model="last_exam_response" ng-disabled="true" value="{{opt}}">
          <span class="checkboxtext" ng-bind-html="opt"></span>
        </li>
      </ul>

      <!-- Exam Feedback-->
      <p ng-show="is_feedback()" class="feedback-full-row" ng-cloak>
        <strong ng-show="last_exam_correct == true" style="color:green">Correct. </strong>
        <strong ng-show="last_exam_correct == false" style="color:red">Incorrect. </strong>
        The answer is: <strong ng-bind-html="instructions[inst_id].options[instructions[inst_id].answer]"></strong>
      </p>
      <p ng-show="is_exam()" class="feedback-full-row"><br></p>

      <!-- Exam Endscreen -->
      <div ng-show="is_exam_end()" class="full-row" ng-cloak>
        <span ng-show="exam_score == exam_results.length">
          Great job, you answered <strong style="color:green">{{exam_score}}/{{exam_results.length}}</strong> questions correctly!<br>
          <br>
          Press <strong>Next</strong> to continue.
        </span>
        <span ng-show="exam_score < exam_results.length">
          You answered <strong style="color:red">{{exam_score}}/{{exam_results.length}}</strong> questions correctly.<br>
          <br>
          Press <strong>Next</strong> to retake the quiz, and try to answer all questions correctly.
        </span>
        <br><br>
      </div>

      <!-- Instruction Image -->
      <img ng-show="section == 'instructions' && instruction_has_image()" ng-src="{{instructions[inst_id].image}}"
        class="stimulus" id="instruction-img" ng-cloak>
      <p class="section_title" ng-show="section == 'instructions' && instruction_has_image()">Tutorial</p>

      <div class="section_title" style="float: left;" ng-show="section == 'stimuli' && part_id >= 0" ng-cloak>
        Round {{stim_id+1}}/{{stimuli_set.length}} </div>
      <div class="section_title" style="float: left;" ng-show="section == 'stimuli' && part_id < 0" ng-cloak>
        Round {{stim_id}}/{{stimuli_set.length}} </div>

      <!-- Stimuli -->
      <div>
        <img ng-show="section == 'stimuli' && part_id >= 0" ng-src="{{cur_stim_image()}}"
          class="stimulus" id="stimulus-img" ng-cloak> 
        <img ng-show="section == 'stimuli' && part_id == -1" ng-src="{{stimuli_set[stim_id-1].images.slice(-1)[0]}}"
          class="stimulus" id="stimulus-img-final" ng-cloak>
      </div>

      <!-- Endscreen -->
      <div id="end" ng-show="section == 'endscreen'" class="full-row" ng-if="section == 'endscreen' && end_id == 0" ng-cloak>
              You're all done! You scored {{total_reward}} points in total, equal to {{total_payment}} bonus payment.
              <br>
              <br>
              Your completion code is: {{user_id}}
              <br><br><br>
      </div>
      <div id="end" ng-show="section == 'endscreen'" class="full-row" ng-if="section == 'endscreen' && end_id == 1" ng-cloak>
          Please answer the following demographic questions:
          <br><br>
          <strong>What is Your Age?   </strong> <input id="age" type="number">
          <br><br>
          <strong>What is your gender?   </strong> <input id="gender" type="text">
          <br><br>
          <strong>What is your Prolific/Mturk ID?   </strong> <input id="mturkID" type="number">
      </div>
      <div id="end" ng-show="section == 'endscreen'" class="full-row" ng-if="section == 'endscreen' && end_id == 2" ng-cloak>
        Thank you for your time :)
      </div>

      <!-- Controls -->
      <div class="controls" ng-cloak>
        <button class="button" ng-click="advance()" ng-show="section == 'stimuli' && part_id <= 0"
          ng-disabled="(stimuli_set.length == 0)">
          Next&ensp;▶
        </button>
        <button class="button" ng-click="advance()" ng-hide="section == 'stimuli' && part_id <= 0 || (section == 'endscreen' && end_id == 2)"
          ng-disabled="(section == 'endscreen' && end_id == 2) ||
            (stimuli_set.length == 0) && !hide_questions() || (valid_belief == false && has_belief_question()) && !hide_questions() ||
            (valid_exam == false && section == 'instructions' && is_exam()) ||
            (valid_comprehension == false && section == 'instructions' && instruction_has_question())">
          Next&ensp;▶
        </button>
      </div>
    </div>

    <!-- Right Side -->
    <div class="w3-col m6" ng-show="show_rhs" style="margin-left: 5%;">

      <!-- Captioned Instructions -->
      <div ng-show="section == 'instructions' && instruction_has_image()" class="captions"
        ng-bind-html="instructions[inst_id].text" ng-cloak>
      </div>

      <!-- Scenario Start -->
      <div ng-show="(section == 'stimuli' && part_id == 0)" class="captions" ng-cloak>
        <p>Please take a moment to look over this empty map.<br><br>
           Press <strong>Next</strong> to continue.
        </p>
      </div>

      <!-- Belief Question -->
      <div id="question" class="captions" ng-cloak>
        <p ng-show="!hide_questions() && has_belief_question()">The game designer has placed the flasks on the map. Please answer the following questions based on where you think the designer placed the potions and poisons:</strong></p>
        <br>
        <div id="ground_truth" ng-show="section == 'stimuli && (part_id == 1 || part_id == -1)" ng-hide="section != 'stimuli' || part_id == 0">
        </div>
        <br>
        <br>
        <ul ng-show="!hide_questions() && has_belief_question()" class="no-bullets" ng-repeat="stmt in belief_statements track by $index">
          <span class="statement"><span ng-bind-html="style_statement(stmt)"></span></span>
          <div class="rating-scale">
              <!-- Definitely False -->
              <div class="rating-button" ng-repeat="n in [1, 2, 3, 4, 5, 6, 7]">
                <label for="belief_rating_{{$parent.$index}}_{{n}}" class="rating-number">{{n}}</label>
                <input type="radio" name="belief_rating_{{$parent.$index}}" id="belief_rating_{{$parent.$index}}_{{n}}"
                  ng-model="response.beliefs[$parent.$index]" ng-value="n" ng-change="validate_belief()"/>
                <label for="belief_rating_{{$parent.$index}}_{{n}}" class="rating-text" ng-bind-html="rating_text[n-1]"></label>
                </div>
              <!-- Definitely True -->
            </div>
        </ul>
      </div>

      <!-- Post-Stimulus Feedback -->
      <p ng-show="section == 'stimuli' && part_id < 0" class="feedback" ng-cloak>
        You earned <strong>{{stim_reward}}</strong> bonus point(s) this round, for a total of <strong>{{total_reward}}</strong> points.<br><br>
        Press <strong>Next</strong> to continue to the next map.
      </p>

      <!-- Comprehension Questions -->
      <div ng-show="section == 'instructions' && instruction_has_question()" class="comprehension_question" ng-cloak>
        <p ng-bind-html="instructions[inst_id].question"></p>

        <ul class="no-bullets" ng-repeat="opt in instructions[inst_id].options">
          <li><input type="radio" name="comprehension" ng-model="comprehension_response" ng-click="validate_answer(opt)"
              value="{{opt}}"> <span class="checkboxtext" ng-bind-html="opt"></span>
          </li>
        </ul>
        <br>

        <div ng-hide="comprehension_response == ''" class="checkboxtext">
          <strong ng-show="valid_comprehension" style="color:green">Correct! Hit the Next button to continue.</strong>
          <strong ng-show="!valid_comprehension" style="color:red">Wrong answer, please try again!</strong>
        </div>
      </div>

      <div ng-show="section == 'instructions'" class="comprehension_question">
        <p ng-bind-html="instructions[inst_id].footnote"></p>
      </div>
</body>

</html>
